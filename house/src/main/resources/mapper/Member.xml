<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
	
<mapper namespace="com.ssafy.house.member.model.mapper.MemberMapper">

	<resultMap type="Member" id="memberDto">
		<result column="user_id" property="userId"/>
		<result column="user_pass" property="userPass"/>
		<result column="user_name" property="userName"/>
		<result column="join_date" property="joinDate"/>
	</resultMap>
	
	<select id="login" parameterType="Member" resultMap="memberDto">
		SELECT user_id, user_pass, user_name, role, rechargeAmount, (select sum(price) as totalAssetPrice
																		from product 
																		where userId = #{userId}) as totalAssetPrice
			FROM member
			WHERE user_id = #{userId}
	</select>
	
	<insert id="registMember" parameterType="Member">
		insert into member(user_id, user_pass, user_name, address, tel)
			values(#{userId}, #{userPass}, #{userName}, #{address}, #{tel})
	</insert>
	
	<!-- 추후에 질문지와 답변을 하드 코딩이 아닌 동적으로 입력 받는 값으로 변경 필요 -->
	<select id="checkUser" parameterType="Member">
		select count(*)
			from member 
		    where role = "user"
				and user_name = #{userName}
				and tel = #{tel}
		        and questionNo = 3
		        and answer = "고기";
	</select>
	
	<update id="resetPassword" parameterType="Member">
	    UPDATE member
		    SET user_pass = #{userPass}
		    WHERE role = "user"
		    	and user_id = #{userId}
	</update>
</mapper>